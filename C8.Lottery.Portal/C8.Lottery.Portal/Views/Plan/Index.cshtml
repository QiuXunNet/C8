@using C8.Lottery.Model
@using C8.Lottery.Public
@{
    Layout = null;

    int lType = ViewBag.lType;

    List<Plan> list = ViewBag.list2;

    string title = "计划-" + ViewBag.lotteryName;

    List<Play> playList = ViewBag.PlayList;

}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>@title</title>
    <link rel="stylesheet" type="text/css" href="~/css/mescroll.min.css" />
    <link rel="stylesheet" type="text/css" href="~/css/dialog.css" />
    <link rel="stylesheet" type="text/css" href="/css/style.css" />
    <script type="text/javascript" src="/js/jquery-1.8.3.min.js"></script>
    <script type="text/javascript" src="~/js/luo/mescroll.min.js"></script>
    <script type="text/javascript" src="~/js/dialog.min.js"></script>
    <script type="text/javascript" src="/js/yjp.js"></script>
    <script type="text/javascript" src="/js/runTime2.js"></script>
</head>
<body style="background:#F4F4F5;">


    <input type="hidden" id="lType" value="@lType" />
    <header class="hjc_header">
        <a href="/Home/Index" class="hjc_back"></a>
        <a href="javascript:;" class="hjc_logo">@title</a>
        <div class="Plan_QiHao">
            <p class="QiHao_tit">近10期</p>
            <div class="QiHao_text">
                <i class="QiHao_Ticon"></i>
                <ul class="QiHao_Nav">
                    <li>近10期</li>
                    <li>近20期</li>
                    <li>近30期</li>
                    <li>近50期</li>
                    <li>近100期</li>
                </ul>
            </div>
        </div>
    </header>
    <div class="guessing_header">
        <ul class="C8_nav5">
            <li class="current"><a href="javascript:;">官方推荐</a></li>
            <li><a href="javascript:;">高手推荐</a></li>
            <li><a href="javascript:;">免费专家</a></li>
        </ul>
        <input type="hidden" id="curNavIndex" value="0" />
        <div style="clear:both;"></div>
    </div>
    <div class="gaoshou">
        <div class="GS_box" style="display: none;">
            @if (playList != null && playList.Any())
            {
                int i = 0;
                <ul id="gsnav" class="GS_nav">
                    @foreach (var play in playList)
                    {
                        if (i == 0)
                        {
                            <li class="current" data-index="@i" data-title="@play.PlayName"><a href="javascript:;">@play.PlayName</a></li>
                        }
                        else
                        {

                            <li data-index="@i" data-title="@play.PlayName"><a href="javascript:;">@play.PlayName</a></li>
                        }
                        i++;
                    }
                </ul>
                <div style="clear: both;"></div>
            }
        </div>
        <a href="javascript:;" class="GS_btn" style="display: none;"><img src="/images/50.png"></a>
    </div>
    <div class="Plan_content">
        @*官方推荐*@
        <div class="Plan_CInfo mescroll">
            <div class="CZ_hdtit">
                <dl class="CZ_hdMain">
                    <dt><a href="javascript:;"><img src="/images/@ViewBag.icon"></a></dt>
                    <dd>
                        <div class="hdM_ddtit">
                            <h3 class="hdM_ddtqi f-l">
                                第<span>@ViewBag.lastIssue</span>期
                            </h3>
                            <p class="hdM_ddtime f-r">
                                下期开奖：

                                @if (ViewBag.time == "正在开奖")
                                {
                                    <span id="openTime">正在开奖</span>
                                }
                                else
                                {
                                    if (lType < 9)
                                    {
                                        <span id="openTime"><t id="hour2">@ViewBag.hour</t>:<t id="minute2">@ViewBag.min</t>:<t id="second2">@ViewBag.sec</t></span>
                                    }
                                    else
                                    {
                                        <span id="openTime"><t id="minute2">@ViewBag.min</t>:<t id="second2">@ViewBag.sec</t></span>
                                    }

                                }
                            </p>
                            <div style="clear: both;"></div>
                        </div>
                        <div class="hdM_ddcon">

                            @{
                                int countFor6 = 0;


                                string num = ViewBag.lastNum;
                                string[] numArr = num.Split(',');


                                if (lType == 5)
                                {
                                    foreach (string s in numArr)
                                    {
                                        countFor6++;

                                        string color = Util.GetColor(s);
                                        string cl = "";
                                        if (color == "red")
                                        {
                                            cl = "hdM_spliu hdM_spliured";
                                        }
                                        else if (color == "green")
                                        {
                                            cl = "hdM_spliu hdM_spliugreen";
                                        }
                                        else
                                        {
                                            cl = "hdM_spliu hdM_spliublue";
                                        }

                                        <span class="@cl">@s</span>

                                        if (countFor6 == 6)
                                        {
                                            <span class="Mif_jgC">+</span>
                                        }

                                    }
                                }
                                else
                                {
                                    foreach (string s in numArr)
                                    {
                                        if (lType == 63 || lType == 64)
                                        {
                                            string clazz = "hdM_spPK hdM_spPK" + s;
                                            <span class="@clazz">@s</span>
                                        }

                                        else
                                        {
                                            <span class="hdM_spssc">@s</span>
                                        }

                                    }
                                }


                            }
                        </div>
                        <div class="hdM_ddZZKJ" style="display: none;">
                            <p>正在开奖中...</p>
                        </div>
                    </dd>
                </dl>
            </div>
            <div class="CZ_hdnav" style="display: none;">
                <ul class="CZ_hdNL f-l">
                    <li class="current"><a href="javascript:;">计划</a></li>
                    <li><a href="javascript:;">双面</a></li>
                    <li><a href="javascript:;">长龙</a></li>
                    <li><a href="javascript:;">走势</a></li>
                    <li><a href="javascript:;">技巧</a></li>
                    <div style="clear: both;"></div>
                </ul>
                <div style="clear: both;"></div>
            </div>
            <div class="CZ_main mt0">
                <!--计划列表-->
                <div class="CZ_Minfo">
                    <div class="Mif_sy">

                        <div class="Mif_sykuai">
                            <table class="Mif_syTable" width="100%" bordercolor="#d9d9d9" border="1">
                                @*查看计划*@
                                <thead>
                                    <tr>
                                        <th colspan="4" scope="col"><a href="/Plan/Look/@lType" class="Mif_titred">@ViewBag.msg</a></th>
                                    </tr>
                                </thead>
                            </table>
                        </div>


                        @foreach (LotteryRecord record in ViewBag.list)
                        {
                            var data = list.Where(p => p.Issue == record.Issue).OrderBy(p => p.Sort);
                            int count2 = -1;   //标志时时彩Sort

                            <div class="Mif_sykuai">

                                <table width="100%" border="1" bordercolor="#d9d9d9" class="Mif_syTable">
                                    @*开奖信息*@
                                    <thead>
                                        <tr>
                                            <th scope="col" width="20%">
                                                <div>
                                                    @if (lType == 63 || lType == 65 || lType < 9)
                                                    {
                                                        <span class="Mif_titred"><font>@record.Issue</font>期</span>
                                                    }
                                                    else
                                                    {
                                                        <span class="Mif_titred"><font>@record.Issue.Substring(4)</font>期</span>
                                                    }

                                                </div>
                                                <div>
                                                    <font>@record.SubTime.ToString("HH:mm")</font>
                                                </div>
                                            </th>
                                            <th colspan="3" scope="col" align="left">
                                                <div class="Mif_Hao">


                                                    @if (lType == 5)
                                                    {
                                                        int countFor62 = 0;

                                                        foreach (string s in record.Num.Split(','))
                                                        {
                                                            countFor62++;


                                                            string color = Util.GetColor(s);
                                                            string cl = "";
                                                            if (color == "red")
                                                            {
                                                                cl = "Mif_jgC Mif_jgCred";
                                                            }
                                                            else if (color == "green")
                                                            {
                                                                cl = "Mif_jgC Mif_jgCgreen";
                                                            }
                                                            else
                                                            {
                                                                cl = "Mif_jgC Mif_jgCblue";
                                                            }

                                                            <span class="@cl">@s</span>

                                                            if (countFor62 == 6)
                                                            {
                                                                <span class="Mif_jgC">+</span>
                                                            }
                                                        }
                                                    }
                                                    else
                                                    {
                                                        foreach (string s in record.Num.Split(','))
                                                        {
                                                            if (lType == 63 || lType == 64)
                                                            {
                                                                string clazz = "Mif_jgA Mif_jgA" + s;
                                                                <span class="@clazz">@s</span>
                                                            }
                                                            else
                                                            {
                                                                <span class="Mif_jgB">@s</span>
                                                            }
                                                        }
                                                    }


                                                </div>


                                                @if ((lType >= 9 && lType < 38) || (lType >= 51 && lType < 60) || (lType >= 63 && lType < 65))
                                                {
                                                    <div class="Mif_Hao" style="margin-top: 5px;">
                                                        @foreach (string s in record.ShowInfo.Split(','))
                                                        {
                                                            <span class="Mif_sp">@s</span>
                                                        }
                                                    </div>

                                                }
                                                else if (lType == 5)
                                                {
                                                    int countFor63 = 0;

                                                    <div class="Mif_Hao" style="margin-top: 5px;">
                                                        @foreach (string s in record.ShowInfo.Split(','))
                                                        {
                                                            countFor63++;
                                                            <span class="Mif_jgC">@s</span>
                                                            if (countFor63 == 6)
                                                            {
                                                                <span class="Mif_jgC">+</span>
                                                            }
                                                        }
                                                    </div>
                                                }

                                            </th>
                                        </tr>
                                    </thead>

                                    @*预测号码*@
                                    <tbody>

                                        @if (lType >= 51 && lType < 60)
                                        {
                                            //快乐十分
                                            foreach (Plan plan in data)
                                            {
                                                count2++;
                                                numArr = plan.Num.Split('|');
                                                string result = plan.Result;
                                                if (!string.IsNullOrEmpty(result))
                                                {
                                                    string[] resultArr = result.Split('|');

                                                    <tr>
                                                        <td width="15%" align="center"><font>@plan.ShowSort</font></td>

                                                        <td width="50%" align="left">

                                                            @if (resultArr[0] == "中")
                                                            {
                                                                @Html.Raw(Util.HandWinNumColor(numArr[0], record.Num, count2))
                                                                <font class="Mif_red">(中)</font>
                                                            }
                                                            else
                                                            {
                                                                <font>@numArr[0]</font>
                                                            }
                                                        </td>
                                                        <td width="15%" align="left">

                                                            <font>@numArr[1]</font>
                                                            @if (resultArr[1] == "中")
                                                            {
                                                                <font class="Mif_red">(中)</font>
                                                            }
                                                        </td>
                                                        <td width="20%" align="left">

                                                            <font>@numArr[2]</font>
                                                            @if (resultArr[2] == "中")
                                                            {
                                                                <font class="Mif_red">(中)</font>
                                                            }
                                                        </td>
                                                    </tr>
                                                }
                                                else
                                                {
                                                    <tr>
                                                        <td width="15%" align="center"><font>@plan.ShowSort</font></td>
                                                        <td width="50%" align="left"><font>@numArr[0]</font></td>
                                                        <td width="15%" align="left"><font>@numArr[1]</font></td>
                                                        <td width="20%" align="left"><font>@numArr[2]</font></td>
                                                    </tr>
                                                }

                                            }
                                        }
                                        else if (lType == 2 || lType == 4 || lType == 8)
                                        {
                                            //双色球
                                            foreach (Plan plan in data)
                                            {
                                                count2++;
                                                numArr = plan.Num.Split('|');
                                                string result = plan.Result;
                                                if (!string.IsNullOrEmpty(result))
                                                {
                                                    string[] resultArr = result.Split('|');





                                                    <tr>
                                                        <td width="20%" align="center"><font>@plan.ShowSort</font></td>


                                                        <td width="40%" align="left">

                                                            <font>@numArr[0]</font>
                                                            @if (resultArr[0] == "中")
                                                            {
                                                                <font class="Mif_red">(中)</font>
                                                            }
                                                        </td>
                                                        <td width="40%" align="left">

                                                            <font>@numArr[1]</font>
                                                            @if (resultArr[1] == "中")
                                                            {
                                                                <font class="Mif_red">(中)</font>
                                                            }
                                                        </td>
                                                    </tr>
                                                }
                                                else
                                                {
                                                    <tr>
                                                        <td width="20%" align="center"><font>@plan.ShowSort</font></td>
                                                        <td width="40%" align="left"><font>@numArr[0]</font></td>
                                                        <td width="40%" align="left"><font>@numArr[1]</font></td>
                                                    </tr>
                                                }

                                            }
                                        }
                                        else if (lType == 5)
                                        {
                                            //六合彩
                                            foreach (Plan plan in data)
                                            {

                                                <tr>
                                                    <td width="20%" align="center"><font>@plan.ShowSort</font></td>
                                                    <td width="50%" align="left">
                                                        <font>@Html.Raw(Util.HandWinNumColorFor6(plan.Num, record.Num, plan.Sort))</font>
                                                    </td>

                                                    <td width="30%" align="center">
                                                        @if (plan.Result == "中")
                                                        {
                                                            <font class="Mif_red">(中)</font>
                                                        }
                                                    </td>
                                                </tr>
                                            }
                                        }
                                        else if (lType == 63 || lType == 64)
                                        {

                                            //北京赛车
                                            foreach (Plan plan in data)
                                            {
                                                count2++;
                                                numArr = plan.Num.Split('|');
                                                string result = plan.Result;
                                                if (!string.IsNullOrEmpty(result))
                                                {
                                                    string[] resultArr = result.Split('|');
                                                    <tr>
                                                        <td width="20%" align="center">
                                                            @if (plan.ShowSort == "冠军" || plan.ShowSort == "亚军")
                                                            {
                                                                <font class="Mif_titred">@plan.ShowSort</font>
                                                            }
                                                            else
                                                            {
                                                                <font>@plan.ShowSort</font>
                                                            }
                                                        </td>

                                                        <td width="40%" align="left">
                                                            @if (resultArr[0] == "中")
                                                            {
                                                                @Html.Raw(Util.HandWinNumColor(numArr[0], record.Num, count2))
                                                                <font class="Mif_red">(中)</font>
                                                            }
                                                            else
                                                            {
                                                                <font>@numArr[0]</font>
                                                            }
                                                        </td>
                                                        <td width="20%" align="left">

                                                            <font>@numArr[1]</font>
                                                            @if (resultArr[1] == "中")
                                                            {
                                                                <font class="Mif_red">(中)</font>
                                                            }
                                                        </td>
                                                        <td width="20%" align="left">

                                                            <font>@numArr[2]</font>
                                                            @if (resultArr[2] == "中")
                                                            {
                                                                <font class="Mif_red">(中)</font>
                                                            }
                                                        </td>

                                                    </tr>

                                                }
                                                else
                                                {
                                                    <tr>
                                                        <td width="20%" align="center">
                                                            @if (plan.ShowSort == "冠军" || plan.ShowSort == "亚军")
                                                            {
                                                                <font class="Mif_titred">@plan.ShowSort</font>
                                                            }
                                                            else
                                                            {
                                                                <font>@plan.ShowSort</font>
                                                            }
                                                        </td>

                                                        <td width="40%" align="left"><font>@numArr[0]</font></td>
                                                        <td width="20%" align="left"><font>@numArr[1]</font></td>
                                                        <td width="20%" align="left"><font>@numArr[2]</font></td>


                                                    </tr>
                                                }

                                            }
                                        }
                                        else
                                        {


                                            //重庆时时彩 11选5
                                            foreach (Plan plan in data)
                                            {
                                                count2++;


                                                if (count2 < 5)
                                                {
                                                    numArr = plan.Num.Split('|');
                                                    string result = plan.Result;
                                                    if (!string.IsNullOrEmpty(result))
                                                    {
                                                        string[] resultArr = result.Split('|');

                                                        <tr>
                                                            <td width="20%" align="center"><font>@plan.ShowSort</font></td>
                                                            <td width="40%" align="left">
                                                                @if (resultArr[0] == "中")
                                                                {
                                                                    @Html.Raw(Util.HandWinNumColor(numArr[0], record.Num, count2))
                                                                    <font class="Mif_red">(中)</font>
                                                                }
                                                                else
                                                                {
                                                                    <font>@numArr[0]</font>
                                                                }
                                                            </td>
                                                            <td width="20%" align="left">
                                                                <font>@numArr[1]</font>
                                                                @if (resultArr[1] == "中")
                                                                {
                                                                    <font class="Mif_red">(中)</font>
                                                                }
                                                            </td>
                                                            <td width="20%" align="left">
                                                                <font>@numArr[2]</font>
                                                                @if (resultArr[2] == "中")
                                                                {
                                                                    <font class="Mif_red">(中)</font>
                                                                }
                                                            </td>
                                                        </tr>
                                                    }
                                                    else
                                                    {
                                                        <tr>
                                                            <td width="20%" align="center"><font>@plan.ShowSort</font></td>
                                                            <td width="40%" align="left"><font>@numArr[0]</font></td>
                                                            <td width="20%" align="left"><font>@numArr[1]</font></td>
                                                            <td width="20%" align="left"><font>@numArr[2]</font></td>
                                                        </tr>
                                                    }

                                                }
                                                else
                                                {
                                                    <tr>
                                                        <td align="center"><font>@plan.ShowSort</font></td>
                                                        <td colspan="3" align="center">
                                                            <font>@plan.Num</font>
                                                            @if (plan.Result == "中")
                                                            {
                                                                <font class="Mif_red">(中)</font>
                                                            }
                                                        </td>
                                                    </tr>
                                                }


                                            }
                                        }



                                    </tbody>

                                </table>
                            </div>

                        }

                    </div>
                </div>
            </div>
        </div>


        @*高手推荐*@
        <div id="mescroll0" class="Plan_CInfo mescroll" style="display: none;">

            <div id="datalist0" class="Plan_CIfBox data-list">

            </div>
        </div>


        @*免费专家*@
        <div id="mescroll1" class="Plan_CInfo mescroll" style="display: none;">
            <div id="datalist1" class="Plan_CIfBox data-list">

            </div>
        </div>
    </div>
    <!--搜索-->
    <div class="Plan_search"><a href="javascript:;"></a></div>



    <script type="text/javascript">

        var curNavIndex = 0;
        var playType = 0;
        var playName = '';
        var queryType = 1;
        $(function () {
            var mescroll = new MeScroll("mescroll0", {
                //上拉加载的配置项
                up: {
                    callback: getListData,
                    isBounce: false, //此处禁止ios回弹
                    noMoreSize: 20,
                    empty: {
                        icon: "/images/null.png",
                        tip: "暂无高手推荐~",
                        btntext: "去看看免费专家 >", //按钮,默认""
                        btnClick: function () {
                            $(".C8_nav5 li:eq(2)").trigger("click");
                            //alertmsg("点击免费专家切换");
                        }
                    },
                    clearEmptyId: "datalist0",
                    toTop: {
                        src: "/images/totop.png",
                        offset: 1000
                    },
                    page: {
                        num:0,
                        size:20,
                        time:null
                    }
                }
            });
            var mescrol2;
            setTimeout(function() {
                queryType = 2;
                mescrol2 = new MeScroll("mescroll1", {
                    //上拉加载的配置项
                    up: {
                        callback: getListData,
                        isBounce: false, //此处禁止ios回弹
                        noMoreSize: 20,
                        empty: {
                            icon: "/images/null.png",
                            tip: "暂无免费专家~",
                            btntext: "去看看高手推荐 >",
                            btnClick: function () {
                                $(".C8_nav5 li:eq(1)").trigger("click");
                                //alertmsg("点击高手推荐切换");
                            }
                        },
                        clearEmptyId: "datalist1",
                        toTop: {
                            src: "/images/totop.png",
                            offset: 1000
                        },
                        page: {
                            num:0,
                            size:20,
                            time:null
                        }
                    }
                });
            }, 2000);
            
            $(".GS_nav li").click(function () {
                var _this = $(this),
                    i = _this.attr("data-index");
                queryType = $("#curNavIndex").val();

                if (!queryType || queryType < 1) return;

                if (playType != i) {
                    playType = i;
                    _this.addClass("current").siblings().removeClass("current");

                    if(queryType==1){
                        mescroll.resetUpScroll();
                        //隐藏回到顶部按钮
                        mescroll.hideTopBtn();
                    }else if (queryType == 2) {
                        
                        mescrol2.resetUpScroll();
                        //隐藏回到顶部按钮
                        mescrol2.hideTopBtn();
                    }
                }
            });

            /*加载列表数据 */
            function getListData(page) {
                
                getListDataFromNet(playType, queryType, page.num, page.size, function (pageData, hasNextPage) {
                    console.log("playType=" + playType + ",queryType=" + queryType + ", page.num=" + page.num + ", page.size=" + page.size + ", pageData.length=" + pageData.length);
                    
                    if (queryType == 1) {
                        mescroll.endSuccess(pageData.length, hasNextPage);
                        //设置高手推荐列表数据
                        buildHtml(pageData, 0);
                    } else if (queryType == 2) {
                        mescrol2.endSuccess(pageData.length, hasNextPage);
                        //设置高手推荐列表数据
                        buildHtml(pageData, 1);
                    }

                }, function () {
                    //隐藏下拉刷新和上拉加载的状态;
                    if (queryType == 1) {
                        mescroll.endErr();
                    } else if (queryType == 2) {
                        mescrol2.endErr();
                    }
                });
            }

            function getListDataFromNet(playType, queryType, pageIndex, pageSize, successCallback, errorCallback) {
                var url = "/Plan/ExpertList";
                $.ajax({
                    type: 'GET',
                    data: {
                        lType:@lType,
                        playName: $("#gsnav li[data-index='" + playType + "']").attr("data-title"),
                        type: queryType,
                        pageIndex: pageIndex,
                        pageSize: pageSize
                    },
                    url: url,
                    dataType: 'json',
                    success: function (res) {

                        if (res.IsSuccess && res.Data) {
                            //回调
                            successCallback(res.Data.PageData, res.Data.HasNextPage);

                        } else {
                            alertmsg("服务器繁忙");
                        }
                    },
                    error: errorCallback
                });
            }

        });

        function buildHtml(data, tabtype) {

            var itemList = [];
            var listDom = $("#datalist" + tabtype);

            $.each(data, function (index, item) {
                var itemHtml = '<div class="CIFB_K">'
                    + '<div class="CIFB_KL f-l">'
                    + '<div class="KL_number f-l">';
                if (item.RowNumber <= 3) {
                    itemHtml += '<div class="KL_nbqs">'
                        + '<img src="/images/44_' + item.RowNumber + '.png">'
                        + '</div>';
                } else {
                    itemHtml += '<span class="KL_nbsp">' + item.RowNumber + '</span>';
                }
                itemHtml += '</div>'
                    + '<div class="KL_port f-l">'
                    + '<div class="port_tu">'
                    + '<a href="/Plan/PlayRecord/'+item.lType+'?uid='+item.UserId+'"><img src="' + item.Avater + '"></a>'
                    + '</div>';
                if (item.RowNumber <= 3) {
                    itemHtml += '<i class="port_sf"><img src="/images/66.png"></i>';
                }

                itemHtml += '</div>'
                + '            <div class="KL_font">'
                + '                <h3 class="KL_fh3On">'
                + '                    <a href="/Plan/PlayRecord/'+item.lType+'?uid='+item.UserId+'">'+item.Name+'</a>'
                + '                </h3>'
                //+ '                <p>1000次查看</p>'
                + '            </div>'
                + '        </div>'
                + '        <div class="CIFB_KR">'
                + '            <div class="KR_L f-l">'
                + '                <h3>'+item.HitRateDesc+'</h3>'
                + '                <p>最大连中'+item.MaxWin+'期</p>'
                + '            </div>'
                + '            <div class="KR_R">'
                + '                <h3>'
                + '                    <span>'+item.PlayTotalScore+'</span></i>'
                + '                </h3>'
                + '                <p>上期'+(item.LastWin?"中":"未中")+'</p>'
                + '            </div>'
                + '        </div>'
                + '    </div>';

                itemList.push(itemHtml);
            });

            var html = itemList.join('');
            listDom.append(html);
        }

    </script>
</body>
</html>
