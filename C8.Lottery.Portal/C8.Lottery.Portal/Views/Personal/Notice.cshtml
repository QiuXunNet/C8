
@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>个人中心-消息提醒</title>
    <link rel="stylesheet" type="text/css" href="~/css/mescroll.min.css" />
    <link rel="stylesheet" type="text/css" href="~/css/dialog.css" />
    <link rel="stylesheet"  href="~/css/jquery.emoji.css"/>
    <link rel="stylesheet" type="text/css" href="~/css/style.css" />
    <script type="text/javascript" src="~/js/jquery.js"></script>
    <script type="text/javascript" src="~/js/luo/mescroll.min.js"></script>
    <script type="text/javascript" src="~/js/dialog.min.js"></script>
    <script type="text/javascript" src="~/js/luo/jquery.emoji.min.js"></script>
    <script type="text/javascript" src="~/js/yjp.js"></script>
</head>

<body style="background:#F4F4F5;">

    <header class="hjc_header">
        <a href="javascript:history.go(-1);" class="hjc_back"></a>
        <a href="javascript:;" class="hjc_logo">消息提醒</a>
    </header>

    <div class="guessing_header">
        <ul class="C8_nav C8_JIlU">
            <li class="current"><a href="javascript:;">
                <p>评论<i>2</i>
                </p><span></span></a></li>
            <li><a href="javascript:;">
                <p>系统消息<i>1</i>
                </p><span></span></a></li>
        </ul>
        <div style="clear:both;"></div>
    </div>

    <div class="details_box">
        <div class="details_info1 mescroll" id="mescroll0">
            <div id="datalist0" class="data-list">
                
            </div>
            @*<div class="TID_Info">
                <div class="TID_Ifk1">
                    <div class="Ifk1_left f-l"><a href="javascript:;"><img src="images/57_2.png"></a>
                    </div>
                    <div class="Ifk1_right">
                        <h3><a href="javascript:;" class="f-r">回复</a><a href="javascript:;">巧巧还好吗</a>
                        </h3>
                        <p>2017-09-04 12:00</p>
                    </div>
                </div>
                <div class="TID_Ifk2">
                    <div class="TID_Ifk2A">
                        <p>大师预测的挺准的，感谢！</p>
                    </div>
                </div>
                <div class="TID_Ifk3">
                    <P><font>他发布于</font><span>双色球</span><span>计划</span></P>
                </div>
            </div>
            <div class="TID_Info">
                <div class="TID_Ifk1">
                    <div class="Ifk1_left f-l"><a href="javascript:;"><img src="images/57_2.png"></a>
                    </div>
                    <div class="Ifk1_right">
                        <h3><a href="javascript:;" class="f-r">回复</a><a href="javascript:;">巧巧还好吗</a>
                        </h3>
                        <p>2017-09-04 12:00</p>
                    </div>
                </div>
                <div class="TID_Ifk2">
                    <div class="TID_Ifk2A">
                        <p>我都两期中蓝了，怎么不给加精呢？</p>
                    </div>
                    <div class="TID_Ifk2B">
                        <p>一只安静的哈士奇：我和你一样，这种情况只是被人设置拦截了吧!</p>
                    </div>
                </div>
                <div class="TID_Ifk3">
                    <P><font>一只安静的哈士奇发布于</font><span>双色球</span><span>计划</span></P>
                </div>
            </div>
            <div class="TID_Info">
                <div class="TID_Ifk1">
                    <div class="Ifk1_left f-l"><a href="javascript:;"><img src="images/57_2.png"></a>
                    </div>
                    <div class="Ifk1_right">
                        <h3><a href="javascript:;" class="f-r">回复</a><a href="javascript:;">巧巧还好吗</a>
                        </h3>
                        <p>2017-09-04 12:00</p>
                    </div>
                </div>
                <div class="TID_Ifk2">
                    <div class="TID_Ifk2A">
                        <p>我都两期中蓝了，怎么不给加精呢？</p>
                    </div>
                    <div class="TID_Ifk2B">
                        <p>一只安静的哈士奇：我和你一样，这种情况只是被人设置拦截了吧!</p>
                    </div>
                </div>
                <div class="TID_Ifk3">
                    <P><font>一只安静的哈士奇发布于</font><span>双色球</span><span>计划</span></P>
                </div>
            </div>
            <div class="TID_Info">
                <div class="TID_Ifk1">
                    <div class="Ifk1_left f-l"><a href="javascript:;"><img src="images/57_2.png"></a>
                    </div>
                    <div class="Ifk1_right">
                        <h3><a href="javascript:;" class="f-r">回复</a><a href="javascript:;">巧巧还好吗</a>
                        </h3>
                        <p>2017-09-04 12:00</p>
                    </div>
                </div>
                <div class="TID_Ifk2">
                    <div class="TID_Ifk2A">
                        <p>我都两期中蓝了，怎么不给加精呢？</p>
                    </div>
                    <div class="TID_Ifk2B">
                        <p>一只安静的哈士奇：我和你一样，这种情况只是被人设置拦截了吧!</p>
                    </div>
                </div>
                <div class="TID_Ifk3">
                    <P><font>一只安静的哈士奇发布于</font><span>双色球</span><span>计划</span></P>
                </div>
            </div>*@
        </div>
        <div id="mescroll1" class="details_info1 mescroll" style="display: none;">
            <div id="datalist1" class="data-list">

                <div class="TID_Info">
                    <div class="TID_Ifk1">
                        <div class="Ifk1_left f-l">
                            <a href="javascript:;"><img src="images/58.png"></a>
                        </div>
                        <div class="Ifk1_right">
                            <h3>
                                <a href="javascript:;">系统消息</a>
                            </h3>
                            <p>2017-09-04 12:00</p>
                        </div>
                    </div>
                    <div class="TID_Ifk2">
                        <div class="TID_Ifk2A">
                            <p>尊敬的用户，您已达到竞猜积分超过1000，恭喜成为收费专家。</p>
                        </div>
                    </div>
                </div>
                <div class="TID_Info">
                    <div class="TID_Ifk1">
                        <div class="Ifk1_left f-l">
                            <a href="javascript:;"><img src="images/58.png"></a>
                        </div>
                        <div class="Ifk1_right">
                            <h3>
                                <a href="javascript:;">系统消息</a>
                            </h3>
                            <p>2017-09-04 12:00</p>
                        </div>
                    </div>
                    <div class="TID_Ifk2">
                        <div class="TID_Ifk2A">
                            <p>尊敬的用户，您已达到竞猜积分超过1000，恭喜成为收费专家。</p>
                        </div>
                    </div>
                </div>
                <div class="TID_Info">
                    <div class="TID_Ifk1">
                        <div class="Ifk1_left f-l">
                            <a href="javascript:;"><img src="images/58.png"></a>
                        </div>
                        <div class="Ifk1_right">
                            <h3>
                                <a href="javascript:;">系统消息</a>
                            </h3>
                            <p>2017-09-04 12:00</p>
                        </div>
                    </div>
                    <div class="TID_Ifk2">
                        <div class="TID_Ifk2A">
                            <p>尊敬的用户，您已达到竞猜积分超过1000，恭喜成为收费专家。</p>
                        </div>
                    </div>
                </div>
                <div class="TID_Info">
                    <div class="TID_Ifk1">
                        <div class="Ifk1_left f-l">
                            <a href="javascript:;"><img src="images/58.png"></a>
                        </div>
                        <div class="Ifk1_right">
                            <h3>
                                <a href="javascript:;">系统消息</a>
                            </h3>
                            <p>2017-09-04 12:00</p>
                        </div>
                    </div>
                    <div class="TID_Ifk2">
                        <div class="TID_Ifk2A">
                            <p>尊敬的用户，您已达到竞猜积分超过1000，恭喜成为收费专家。</p>
                        </div>
                    </div>
                </div>
                <div class="TID_Info">
                    <div class="TID_Ifk1">
                        <div class="Ifk1_left f-l">
                            <a href="javascript:;"><img src="images/58.png"></a>
                        </div>
                        <div class="Ifk1_right">
                            <h3>
                                <a href="javascript:;">系统消息</a>
                            </h3>
                            <p>2017-09-04 12:00</p>
                        </div>
                    </div>
                    <div class="TID_Ifk2">
                        <div class="TID_Ifk2A">
                            <p>尊敬的用户，您已达到竞猜积分超过1000，恭喜成为收费专家。</p>
                        </div>
                    </div>
                </div>
                <div class="TID_Info">
                    <div class="TID_Ifk1">
                        <div class="Ifk1_left f-l">
                            <a href="javascript:;"><img src="images/58.png"></a>
                        </div>
                        <div class="Ifk1_right">
                            <h3>
                                <a href="javascript:;">系统消息</a>
                            </h3>
                            <p>2017-09-04 12:00</p>
                        </div>
                    </div>
                    <div class="TID_Ifk2">
                        <div class="TID_Ifk2A">
                            <p>尊敬的用户，您已达到竞猜积分超过1000，恭喜成为收费专家。</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">

        $(function () {
            var curNavIndex = 0;
            var mescrollArr = new Array(3);
            mescrollArr[0]=initMescroll("mescroll0", "datalist0");

            $(".C8_JIlU li").click(function () {
                var _this = $(this),
                    i = _this.attr("data-index");

                if (curNavIndex != i) {
                    _this.addClass("current").siblings().removeClass("current");
                    //隐藏当前列表和回到顶部按钮
                    $("#mescroll"+curNavIndex).hide();
                    mescrollArr[curNavIndex].hideTopBtn();
                    //显示对应的列表
                    $("#mescroll"+i).show();
                    //取出菜单所对应的mescroll对象,如果未初始化则初始化
                    if(mescrollArr[i]==null){
                        mescrollArr[i]=initMescroll("mescroll"+i, "datalist"+i);
                    }else{
                        //检查是否需要显示回到到顶按钮
                        var curMescroll=mescrollArr[i];
                        var curScrollTop=curMescroll.getScrollTop();
                        if(curScrollTop>=curMescroll.optUp.toTop.offset){
                            curMescroll.showTopBtn();
                        }else{
                            curMescroll.hideTopBtn();
                        }
                    }
                    //更新标记
                    curNavIndex=i;
                }

            });

            /*创建MeScroll对象*/
            function initMescroll(mescrollId,clearEmptyId){

                var mescroll = new MeScroll(mescrollId, {
                    //上拉加载的配置项
                    up: {
                        callback: getListData,
                        isBounce: false, //此处禁止ios回弹
                        noMoreSize: 1,
                        empty: {
                            icon: "/images/null.png",
                            tip: "暂无相关数据~",
                            //btntext: "去逛逛 >", //按钮,默认""
                            //btnClick: function() {
                            //    alertmsg("去逛逛");
                            //}
                        },
                        clearEmptyId: clearEmptyId
                    }
                });
                return mescroll;
            }

            /*加载列表数据 */
            function getListData(page){
                //联网加载数据
                var dataIndex=curNavIndex; //记录当前联网的nav下标,防止快速切换时,联网回来curNavIndex已经改变的情况;
                getListDataFromNet(dataIndex, page.num, page.size, function(pageData,hasNextPage){
                    console.log("dataIndex="+dataIndex+", curNavIndex="+curNavIndex+", page.num="+page.num+", page.size="+page.size+", pageData.length="+pageData.length);
                    mescrollArr[dataIndex].endSuccess(pageData.length, hasNextPage);

                    //设置列表数据
                    buildHtml(pageData, dataIndex);
                }, function(){
                    //隐藏下拉刷新和上拉加载的状态;
                    mescrollArr[dataIndex].endErr();
                });
            }

            function getListDataFromNet(curNavIndex,pageIndex,pageSize,successCallback,errorCallback)
            {
                var url;
                if (curNavIndex == 0) {
                    url = "/Personal/GetCommentNotice";
                } else if (curNavIndex == 1) {
                    //查询系统消息
                    url = "/Notice/Last";
                    return;
                } else {
                    return;
                }
                $.ajax({
                    type: 'GET',
                    data: {
                        uid: @(ViewBag.UserId??0),
                        pageIndex: pageIndex,
                        pageSize: pageSize
                    },
                    async:false,
                    url: url,
                    dataType: 'json',
                    success: function(res){

                        if (res.IsSuccess && res.Data) {
                            //回调
                            successCallback( res.Data.PageData,res.Data.HasNextPage);
                            
                            if (curNavIndex == 0) {
                                $("#mescroll0").parseEmoji();
                            }
                        } else {
                            alertmsg("服务器繁忙");
                        }
                    },
                    error: errorCallback
                });
            }

        });

        function buildHtml(data, curNavIndex) {

            var itemList = [];
            var listDom=$("#datalist"+curNavIndex);
            if (curNavIndex == 0) {
                $.each(data, function (index, item) {
                    var itemHtml = '<div class="TID_Info">'
                        + '<div class="TID_Ifk1">'
                        + '	<div class="Ifk1_left f-l"><a href="javascript:;"><img src="' + item.Avater + '"></a></div>'
                        + '	<div class="Ifk1_right">'
                        + '		<h3><a href="javascript:;">' + item.NickName + '</a></h3>'
                        + '		<p>' + item.SubTimeStr + '</p>'
                        + '	</div>'
                        + '</div>'
                        + '<div class="TID_Ifk2">'
                        + '	<div class="TID_Ifk2A">'
                        + '		<p>' + item.Content + '</p>'
                        + '	</div>';

                    var parentComment = item.ParentComment;
                    var denamicType = item.Type == 1 ? "计划" : "资讯";
                    if (parentComment) {
                        itemHtml += '	<div class="TID_Ifk2B">'
                            + '		<p>' + parentComment.NickName + '：' + parentComment.Content + '</p>'
                            + '	</div>'
                            + '</div>'
                            + '<div class="TID_Ifk3">'
                            + '	<P><font>' + parentComment.NickName + '发布于</font><span>' + item.LotteryTypeName + '</span><span>' + denamicType + '</span></P>'
                            + '</div>'
                            + '</div>';
                    } else {

                        itemHtml += '</div>'
                            + '<div class="TID_Ifk3">'
                            + '	<P><font>我发布于</font><span>' + item.LotteryTypeName + '</span><span>' + denamicType + '</span></P>'
                            + '</div>'
                            + '</div>';
                    }
                    itemList.push(itemHtml);
                });
            } else if (curNavIndex == 1) {
                $.each(data, function (index, item) {
                    //拼接系统消息
                    var itemHtml = '';
                    itemList.push(itemHtml);
                });
            }

            var html = itemList.join('');
            listDom.append(html);
        }

    </script>
</body>
</html>
