@{
    Layout = null;
}
<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0" />
    <title>首页</title>
    <link rel="stylesheet" href="/css/Chat/common.css">
    <link rel="stylesheet" href="/css/Chat/base.css" />
    <link rel="stylesheet" href="/css/Chat/index.css" />
</head>
<body>
    <!--页面内容-->
    <div class="layout">
        @*<header class="topBarBox">
                <div class="topBar topBar_record">
                    <a href="/Talking/ChatRoom/@ViewBag.RoomId" class="a_back"></a>
                    <h3>
                        <p class="title">处理记录</p>
                    </h3>
                    <a href="/Talking/BlackList/@ViewBag.RoomId" class="a_gl">拉黑列表</a>
                </div>
            </header>*@

        <header class="header">
            <a href="/Talking/ChatRoom?roomId=@ViewBag.RoomId&roomName=@ViewBag.RoomName" class="a_back"></a>
            <div class="h_title">
                <h1>处理记录</h1>
            </div>
            @if (ViewBag.IsAdmin == true)
            {
                <a href="/Talking/BlackList?roomId=@ViewBag.RoomId&roomName=@ViewBag.RoomName" class="a_gl" style="width:auto;margin-right: 10px; right: 0;">拉黑列表</a>
            }
        </header>
        <main class="main" id="main">
        </main>
    </div>

    <script src="/Scripts/jquery-1.8.0.min.js"></script>
    <script type="text/javascript">
        var isBottom = false;

        $(function () {
            var winH = $(window).height();

            $("#main").height(winH - 60);

            getProcessingRecords();

            //滚动条滚动事件
            $("#main").bind("scroll", function () {
                if ($("#main")[0].scrollHeight - $("#main")[0].scrollTop == $("#main").height() && !isBottom) {
                    getProcessingRecords();
                }
            });
        });

        //获取处理记录
        function getProcessingRecords() {
            var id = 0;
            var lis = $("#main").find("li");

            if (lis.length > 0) {
                id = lis.last().attr("id");
            }

            $.post("/Talking/GetProcessingRecords", { id: id,roomId:@ViewBag.RoomId}, function (data) {
                if (data.Status == 1 && data.DataList.length > 0) {
                    if (data.DataList.length < 20)
                        isBottom = true;

                    var currDate = "";
                    var re_times = $(".re_time", "#main");
                    if (re_times.length > 0) {
                        currDate = re_times.last().attr("id");
                    }

                    $(data.DataList).each(function () {
                        if (currDate == this.Date) {
                            $("#" + currDate).next().find("ul").append("<li id="+this.Id+">" + this.Message + "<span>" + this.Time + "</span></li>");
                        }
                        else {
                            currDate = this.Date
                            var html = "";
                            html += "<dl class='record'>";
                            html += "   <dt class='re_time' id ='" + this.Date + "'>" + this.Date + "</dt>";
                            html += "   <dd class='re_notes'>";
                            html += "       <ul>";
                            html += "           <li id=" + this.Id +">" + this.Message + "<span>" + this.Time + "</span></li>";
                            html += "       </ul >";
                            html += "   </dd >";
                            html += "</dl >";
                            $("#main").append(html);
                        }
                    });
                }
            });
        }
    </script>

</body>

@{Html.RenderAction("index", "PvUvIp");}
</html>
