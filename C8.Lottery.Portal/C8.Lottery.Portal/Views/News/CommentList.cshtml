@{
    Layout = null;
}
@using C8.Lottery.Model
@model List<Comment>
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>评论</title>
    <link rel="stylesheet" type="text/css" href="~/css/dropload.css" />
    <link rel="stylesheet" type="text/css" href="~/css/dialog.css" />
    <link href="~/css/jquery.emoji.css" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="~/css/style.css" />
    <link rel="stylesheet" type="text/css" href="~/css/c8-icon.css" />
    <script type="text/javascript" src="~/js/jquery-1.8.3.min.js"></script>
    <script type="text/javascript" src="~/js/luo/dropload.min.js"></script>
    <script type="text/javascript" src="~/js/dialog.min.js"></script>
    <script src="~/js/luo/jquery.emoji.min.js"></script>
    <script type="text/javascript" src="~/js/yjp.js"></script>
</head>
<body style="background:#F4F4F5;">
    <header class="hjc_header">
        <a href="javascript:history.go(-1);" class="hjc_back"></a>
        <a href="javascript:;" class="hjc_logo">评论</a>
    </header>

    @if (Model != null && Model.Count > 0)
    {
        <div class="Gues_comment" style="margin-top: 50px;">
            <div class="Gues_comTitle">
                <h3>精彩评论</h3>
                <div style="clear: both;"></div>
            </div>
            <div class="Gues_Cbox" id="Gues1">
                <ul class="Gues_ul">
                    @foreach (var comment in Model)
                    {
                        <li>
                            <dl class="Guse_CDL">
                                <dt><a href="/Personal/UserCenter/@comment.UserId"><img src="@Url.Content(comment.Avater)"></a></dt>
                                <dd>
                                    <div class="CDL_DDTop">
                                        <h3>
                                            <a href="/Personal/UserCenter/@comment.UserId">@comment.NickName</a>
                                        </h3>
                                        <p>@comment.SubTime.ToString("yyyy-MM-dd HH:mm")</p>
                                    </div>
                                    <div class="CDL_DDFont">
                                        <p>@comment.Content</p>
                                    </div>
                                </dd>
                            </dl>
                            <div class="comp_Dlk4">
                                <a href="javascript:;" class="comp_DZ">
                                    @if (comment.CurrentUserLikes > 0)
                                    {
                                        <i class="on" data-id="@comment.Id" data-ctype="2" data-commenttype="@comment.Type"><img src="/images/46_1.png" class="DZ_tu1"><img src="/images/46_2.png" class="DZ_tu2"></i>
                                    }
                                    else
                                    {
                                        <i data-id="@comment.Id" data-ctype="1" data-commenttype="@comment.Type"><img src="/images/46_1.png" class="DZ_tu1"><img src="/images/46_2.png" class="DZ_tu2"></i>
                                    }
                                    @if (comment.StarCount > 0)
                                    {
                                        <span>@comment.StarCount</span>
                                    }
                                </a>
                                <a href="/Comment/Index/@comment.Id?ctype=2&type=@ViewBag.Type" class="comp_HF"><img src="/images/46_3.png"></a>
                            </div>
                            @if (comment.ReplayCount > 0)
                            {
                                <div class="comp_replay">
                                    <a href="/News/CommentDetail/@comment.Id?type=@ViewBag.Type">查看全部<span>@comment.ReplayCount</span>条回复>></a>
                                </div>
                            }
                        </li>
                    }
                </ul>
                <ol class="Gues_ol"></ol>
            </div>
        </div>
    }
    <div class="Gues_comment">
        <div class="Gues_comTitle">
            <h3>最新评论<span id="totalCount"></span></h3>
            <div style="clear:both;"></div>
        </div>
        <div class="Gues_Cbox" id="Gues2">
            <ul class="Gues_ul"></ul>
            <ol class="Gues_ol"></ol>
        </div>
    </div>
    <div class="Gues_footer">
        <div class="Gues_ftTB f-r">
            <a href="javascript:;" class="ftTB_A">
                <img src="/images/62_1.png">
                <font>@ViewBag.CommentTotalCount</font>
            </a>
            @*<a href="javascript:showShare();" class="ftTB_A ShareBtn"><img src="/images/62_2.png"></a>*@
        </div>
        <a href="/Comment/Index/@ViewBag.ArticleId?ctype=1&type=@ViewBag.Type" class="Gues_ftFBPL">请输入您的评论</a>
    </div>

    <!--分享-->
    <div class="Gues_share">
        <div class="Share_info">
            <div class="Share_ifTitle">
                <h3>分享至</h3>
            </div>
            <ul class="Share_ifNav">
                <li>
                    <a href="javascript:;">
                        <div class="Share_iNtu"><img src="/images/63_1.png"></div>
                        <p>微信好友</p>
                    </a>
                </li>
                <li>
                    <a href="javascript:;">
                        <div class="Share_iNtu"><img src="/images/63_2.png"></div>
                        <p>朋友圈</p>
                    </a>
                </li>
                <li>
                    <a href="javascript:;">
                        <div class="Share_iNtu"><img src="/images/63_3.png"></div>
                        <p>QQ好友</p>
                    </a>
                </li>
                <div style="clear:both;"></div>
            </ul>
            <a href="javascript:hideShare();" class="Del_Share">取消分享</a>
        </div>
    </div>
    <script type="text/javascript">
        var id=@ViewBag.ArticleId,
            ctype=@ViewBag.Type;

        var pageIndex = 1,
            pageSize = 20;
        $(function() {

            $("#Gues1").parseEmoji();
            var dropload = $("#Gues2").dropload({
                scrollArea: window,
                domDown: {
                    domClass: 'dropload-down',
                    domRefresh: '',
                    domLoad: '<div class="dropload-load"><span class="loading"></span>加载中...</div>',
                    domNoData: '<div class="dropload-noData"><img src="/images/null.png" alt="暂无数据" />暂无数据</div>'
                },
                loadDownFn: function(me) {
                    $.ajax({
                        type: 'GET',
                        url: '/News/LastComment',
                        data: {
                            id: id,
                            type: ctype,
                            pageIndex: pageIndex,
                            pageSize: pageSize,
                            refUid:@ViewBag.RefUid
                            },
                        dataType: 'json',
                        success: function(res) {
                            if (res.Data.TotalCount < 1) {
                                me.noData();
                            }
                            if (res.IsSuccess && res.Data) {
                                buildHtml(res.Data);

                                if (res.Data.HasNextPage) {
                                    pageIndex++;
                                } else {
                                    me.lock();
                                }
                            } else {
                                alertmsg("服务器繁忙");
                            }

                            dropload.resetload();

                        },
                        error: function(xhr, type) {
                            alertmsg("服务器繁忙");
                            dropload.resetload();
                        }
                    });
                }
            });
        });

        function buildHtml(data) {
            var html = [];

            $.each(data.PageData, function(index, value) {
                var li = '<li>'
                    + '<dl class="Guse_CDL">'
                    + '<dt><a href="/Personal/UserCenter/' + value.UserId + '"><img src="' + (value.Avater.length <= 0 ? '/images/default_avater.png' : value.Avater) + '"></a></dt>'
                    + '<dd>'
                    + ' <div class="CDL_DDTop">'
                    + '<h3><a href="/Personal/UserCenter/' + value.UserId + '">' + value.NickName + '</a></h3>'
                    + '<p>' + value.SubTimeStr + '</p>'
                    + ' </div>'
                    + '<div class="CDL_DDFont">'
                    + ' <p>' + value.Content + '</p>'
                    + '</div>'
                    + '</dd>'
                    + '</dl>'
                    + '<div class="comp_Dlk4">'
                    + '<a href="javascript:;" class="comp_DZ">';
                if (value.CurrentUserLikes > 0) {
                    li += '<i class="on" data-id="' + value.Id + '" data-ctype="2" data-commenttype="' +value.Type+ '"><img src="/images/46_1.png" class="DZ_tu1"><img src="/images/46_2.png" class="DZ_tu2"></i>';
                } else {
                    li += '<i data-id="' + value.Id + '" data-ctype="1" data-commenttype="' +value.Type+ '"><img src="/images/46_1.png" class="DZ_tu1"><img src="/images/46_2.png" class="DZ_tu2"></i>';
                }
                li+= '<span>' + (value.StarCount > 0 ? value.StarCount : '') + '</span>'
                    + '</a>'
                    + '<a href="/Comment/Index/' + value.Id + '?ctype=2&type=' + ctype + '" class="comp_HF"><img src="/images/46_3.png"></a>'
                    + '</div>'
                    + (value.ReplayCount > 0 ? '<div class="comp_replay"><a href="/News/CommentDetail/' + value.Id + '?type='+value.Type+'">查看全部<span>' + value.ReplayCount + '</span>条回复>></a></div>' : '')
                    + '</li>';
                li = $.stringParseEmoji(li);
                html.push(li);
            });

            $("#Gues2 .Gues_ul").append(html.join(''));
            $("#totalCount").html('（' + data.TotalCount + '）');
        }

    </script>
</body>
@{Html.RenderAction("index", "PvUvIp");}
</html>
